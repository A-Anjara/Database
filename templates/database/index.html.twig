{% extends 'base.html.twig' %}

{% block title %}BSpaydb
{% endblock %}


{% block body %}

	<input type="hidden" value="{{path('fetch_user_info')}}" id='apiGetUser'>
	<input type="hidden" value="{{path('fetch_user_parrainage')}}" id='apiGetParrainage'>
	<input type="hidden" value="{{path('fetch_user_transaction')}}" id='apiGetTransaction'>


	<section>
		<h1 class="text-xl md:text-2xl  font-bold text-teal-950 py-3">Mettre à jour la Base de donnée</h1>
		{{ form_start(form,{'attr':{'class': "py-2 flex",'data-controller':'form'}}) }}

		<button type="submit" class="bg-teal-500 p-2  text-white font-semibold ">
			Valider
		</button>

		<label for="{{ field_id(form.excelFile) }}" class="bg-teal-100 p-2 min-w-1/4 block hover:bg-teal-200" data-form-target="output">
			D&eacute;poser le fichier excel ici
		</label>
		<input type="file" name="{{ field_name(form.excelFile) }}" id="{{field_id(form.excelFile)}}" class="hidden" data-form-target="input" data-action="input->form#changeFileValue"/>
		{% do form.excelFile.setRendered %}
		{{form_end(form)}}
		{% if error %}
		Error: {{error}}
		{% endif %}
		
	</section>


	<section class="my-4">
		<h1 class="text-xl md:text-2xl text-center  font-bold text-teal-950 py-3">Liste des utilisateurs</h1>
		<div class="max-w-screen overflow-scroll max-h-[75vh] border-t-2 border-teal-950">
			<table class="border-collapse min-w-screen">
				<thead class="bg-teal-100 sticky top-0 ">
					<tr>
						<th class="border border-teal-950/50 p-2">ID</th>
						<th class="border border-teal-950/50 p-2">Nom</th>
						<th class="border border-teal-950/50 p-2">Email</th>
						<th class="border border-teal-950/50 p-2">Code</th>
						<th class="border border-teal-950/50 p-2">Adresse</th>
						<th class="border border-teal-950/50 p-2">Telephone</th>
						<th class="border border-teal-950/50 p-2">Fokontany</th>
						<th class="border border-teal-950/50 p-2">Activite</th>
						<th class="border border-teal-950/50 p-2">Nif</th>
						<th class="border border-teal-950/50 p-2">Personne</th>
						<th class="border border-teal-950/50 p-2">Date</th>
					</tr>
				</thead>
				<tbody>
					{% for row in utilisateurs %}

						<tr class="bg-teal-100/50 hover:bg-teal-200" data-controller="modal" data-action="click->modal#openModal">
							<td class="border border-teal-950/50 p-2">{{row.id}}</td>
							<td class="border border-teal-950/50 p-2">{{row.nom}}</td>
							<td class="border border-teal-950/50 p-2">{{row.email}}</td>
							<td class="border border-teal-950/50 p-2 text-nowrap">{{row.code}}</td>
							<td class="border border-teal-950/50 p-2">{{row.adresse}}</td>
							<td class="border border-teal-950/50 p-2">{{row.telephone}}</td>
							<td class="border border-teal-950/50 p-2">{{row.fokontany}}</td>
							<td class="border border-teal-950/50 p-2">{{row.activite}}</td>
							<td class="border border-teal-950/50 p-2">{{row.nif}}</td>
							<td class="border border-teal-950/50 p-2">{{row.personne}}</td>
							<td class="text-nowrap border border-teal-950/50 p-2" data-controller="date" data-date-date-value="{{ row.date.date }}"></td>
						</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>


	</section>


	<!-- MODAL CONTENEUR -->
	<div
		class="fixed bottom-0 left-0 w-full p-3 bg-black/40 flex items-center justify-center hidden" id="modalContainer">
		<!-- MODAL -->
		<div
			class="bg-white flex flex-col items-stretch relative ">

			<!-- MODAL TABS -->
			<div class=" flex bg-teal-800 items-center w-full text-white">
				<div class="cursor-default flex items-center justify-center p-2 bg-red-500 hover:bg-red-600 text-white " {{ stimulus_controller('modal') }} {{ stimulus_action('modal','closeModal','click') }}>
					<span>&Cross;</span>
				</div>
				<label for="infoTab" class="p-2  hover:bg-white hover:text-black [&[active]]:bg-white [&[active]]:text-black " id="modalRadioInfo" {{ stimulus_controller('modal') }} {{ stimulus_action('modal','loadInfo','click') }}>Info</label>
				<label for="parrainageTab" class="p-2  hover:bg-white hover:text-black [&[active]]:bg-white [&[active]]:text-black" id="modalRadioParrainage" {{ stimulus_controller('modal') }} {{ stimulus_action('modal','loadParrainage','click') }}>Parrainage</label>
				<label for="transactionTab" class="p-2  hover:bg-white hover:text-black [&[active]]:bg-white [&[active]]:text-black" id="modalRadioTransaction" {{ stimulus_controller('modal') }} {{ stimulus_action('modal','loadTransaction','click') }}>Transaction</label>


			</div>

			<!-- MODAL CORPS INFO -->
			<div class="hidden has-checked:block max-h-[40vh] overflow-y-scroll relative">
				<input type="radio" class="hidden" name="modaltab" id="infoTab" checked>

				<div
					class="flex">

					<!-- MODAL GAUCHE -->
					<div
						class="p-2 pb-0 grow">

						<!-- MODAL ENTETE -->
						<div class="font-bold pb-3">
							<div id="modalName">NOM</div>
							<div class="flex justify-between gap-2 ">
								<div class="text-teal-600 text-sm" id="modalCode">Code</div>
								<div class="size-14 border border-black/50 ">
									<img src="" alt="QR Code" id="modalQRCode" class="block size-full">
								</div>
							</div>
						</div>

						<!-- MODAL CORPS -->
						<div class="border-l-2 border-teal-950 px-2 flex flex-col gap-1">
							<div>Parent:
								<span id="modalParent"></span>
							</div>
							<div>Cotisant:
								<span id="modalCotisant"></span>
							</div>

							<div>Membre:
								<span id="modalMembre"></span>
							</div>
						</div>

					</div>

					<!-- MODAL DROITE -->
					<div
						class="p-3 bg-teal-600 text-white">

						<!-- SIKLA CONTAINER -->
						<div
							class="relative size-28 flex flex-col items-center text-center rounded-full overflow-hidden ">

							<!-- SIKLA CENTRE -->
							<div class="absolute top-1/2 left-1/2 size-1/5 z-30 -translate-1/2 rounded-full overflow-hidden bg-gray-600 border-2 border-teal-600" id="modalSiklaCenter"></div>

							<!-- SIKLA INNER -->
							<div class="absolute top-1/2 left-1/2 size-3/5 border-2 border-teal-600  z-20 -translate-1/2 flex flex-col rounded-full overflow-hidden" id="modalSiklaInner">
								<div class="bg-gray-400 w-full h-1/2"></div>
								<div class="bg-gray-600 w-full h-1/2"></div>
							</div>

							<!-- SIKLA OUTER -->
							<div
								class="absolute top-1/2 left-1/2 size-full bg-gray-600 z-10 -translate-1/2 flex flex-wrap" id="modalSiklaOuter">
								<!-- SIKLA ABOVE -->
								<div class="w-1/2 h-1/2 bg-gray-600 "></div>
								<div class="w-1/2 h-1/2 bg-gray-400 "></div>

								<!-- SIKLA BELOW -->
								<div class="w-1/2 h-1/2 bg-gray-400 "></div>
								<div class="w-1/2 h-1/2 bg-gray-600 "></div>
							</div>

						</div>

						<!-- TITRE -->
						<div class="text-center text-sm p-4">ETAT SIKLA</div>

						<!-- INFO SIKLA -->
						<div class="text-sm flex flex-col gap-3">
							<div>Direct :
								<span id="modalDirect"></span>
							</div>
							<div>Indirect :
								<span id="modalIndirect"></span>
							</div>
						</div>


					</div>

				</div>

				<!-- MODAL FOOTER -->
				<div class="p-1 pt-5 sticky bottom-0 bg-white z-40">
					<div class="border-t border-teal-950 text-xs flex justify-between gap-4">
						<div>
							<div id="modalEmail"></div>
							<div id="modalTelephone"></div>
						</div>
						<div>
							<div class="text-[10px]">Utilisateur depuis
								<span id="modalDate"></span>
							</div>
						</div>
					</div>

				</div>
			</div>


			<!-- MODAL CORPS PARRAINAGE  -->
			<div class="p-2 hidden has-checked:block max-h-[40vh] overflow-y-scroll">
				<input type="radio" class="hidden" name="modaltab" id="parrainageTab">
				<table class=" text-sm border-collapse border border-teal-950 min-w-full">
					<thead class="bg-teal-700 text-white">
						<tr>
							<th class="border border-teal-950 p-2">Date</th>
							<th class="border border-teal-950 p-2">Parrain&eacute;</th>
						</tr>
					</thead>
					<tbody id="modalTableParrainage"></tbody>
					<tfoot class="sticky bottom-0  bg-teal-950 text-white p-2 ">
						<tr>
							<td>TOTAL PARRAIN&Eacute;</td>
							<td id="modalParraine"></td>
						</tr>
					</tfoot>
				</table>

			</div>


			<!-- MODAL CORPS TRANSACTION  -->
			<div class="p-2 hidden has-checked:block max-h-[40vh] overflow-y-scroll">
				<input type="radio" class="hidden" name="modaltab" id="transactionTab">
				<table class=" text-sm border-collapse border border-teal-950 min-w-full max-h-[40vh] overflow-scroll max-w-screen">
					<thead class="bg-teal-700 text-white">
						<tr>
							<th class="border border-teal-950 p-2">Date</th>
							<th class="border border-teal-950 p-2">Libellé</th>
							<th class="border border-teal-950 p-2">Montant</th>
						</tr>
					</thead>
					<tbody id="modalTableTransaction"></tbody>

					<tfoot class="sticky bottom-0  bg-teal-950 text-white p-2">
						<tr>
							<td colspan="2">SOLDE</td>
							<td id="modalPortefeuille"></td>
						</tr>
					</tfoot>
				</table>

			</div>


		</div>
	</div>


{% endblock %}
